## 关系数据结构

> [!definition] 关系模型
> 用**二维表**结构表示实体集，**外码**表示实体间联系的数据模型称为**关系模型**。

### 关系与关系模式

#### 关系

给定一组**域 (domain)** $D_{1},D_{2},\cdots, D_{n}$，其 Cartesian 积 $D_{1} \times D_{2} \times \cdots \times D_{n}$ 的一个有限子集称为**关系 (relation)**，每个元素 $t = (d_{1}, d_{2}, \cdots, d_{n}) \in D_{1} \times D_{2} \times \cdots \times D_{n}$ 称为**元组 (tuple)**。

$D_{1},D_{2},\cdots, D_{n}$ 的 Cartesian 积上的关系记作 $\mathscr{R}(D_{1},D_{2},\cdots,D_{n})$，$n$ 称为**关系 $\mathscr{R}$ 的度 (degree)**，$\| \mathscr{R} \|$ 称为**关系 $\mathscr{R}$ 的基数 (cardinality)**。只有 Cartesian 积的子集才有实际意义。

#### 关系的码

一个关系对应于一张**二维表**：
+ 每个**域**对应于表中的一列，称为**属性 (attribute)**；
+ 每个**元组**对应于表中的一行，称为**记录 (record)** 或**条目 (entry)**。

能唯一标识一条记录的属性（组）称为**候选码 (candidate key)**，从中选出一个作为**主码 (primary key)**。主码的属性称为**主属性 (prime attribute)**，其余属性称为**非主属性 (non-key attribute)**。每个关系都必定有且只有一个主码；主码一经选定，不能随意更改。

如果关系 $\mathscr{R}_{1}$ 的一个属性是关系 $\mathscr{R}_{2}$ 的主码，则称 $\mathscr{R}_{1}$ 中的该属性为**外码 (foreign key)**，$\mathscr{R}_{1}$ 中的记录可以通过该外码与 $\mathscr{R}_{2}$ 中的记录建立联系。关系的主码也可成为关系自身的外码，使得其中记录之间可以建立联系。

#### 关系的结构

> [!definition] 规范化关系
> 如果一个关系 $\mathscr{R}$ 的每个属性都是**原子的（不可分的）**，则称 $\mathscr{R}$ 是**规范化关系 (normalized relation)**。

规范化的关系有以下性质：
+ 关系的属性取值是**同质的**，每个属性中的值都来自同一域，具有相同的数据类型；
+ 关系中不同的属性可以来自不同的域，也可以出自同一域；
+ 每个属性的值都是**原子的**，即不可再分的基本数据项；
+ 属性的次序可以任意交换；
+ 记录的次序可以任意交换；
+ 关系中**不允许有重复的记录**。

> [!definition] 关系模式
> 关系的**结构**称为**关系模式 (relation schema)**，记作 $\mathscr{R}(U,D,\mathrm{dom},F)$，其中：
> + $\mathscr{R}$ 是关系名；
> + $U = \{A_{1}, A_{2}, \cdots, A_{n}\}$ 是属性集，$n$ 是关系的度；
> + $D = \{D_{1}, D_{2}, \cdots, D_{n}\}$ 是域集，$D_{i}$ 是属性 $A_{i}$ 的域；
> + $\mathrm{dom}: U \rightarrow D$ 是属性向域的映像集合，$\mathrm{dom}(A_{i}) = D_{i}$；
> + $F$ 是属性间数据的依赖关系集合。
> 
> 关系模式通常简记为 $\mathscr{R}(U)$ 或 $\mathscr{R}(A_{1}, A_{2}, \cdots, A_{n})$。

### 关系的完整性约束

关系模型有三类**完整性约束 (integrity constraint)**：
+ **实体完整性 (entity integrity)**，即主码约束，要求关系的主码属性值不能为空且唯一；
+ **参照完整性 (referential integrity)**，即外码约束，要求关系的外码属性值要么为空，要么必须在所参照的关系中存在；
+ **用户定义完整性 (user-defined integrity)**，即用户根据实际应用需要定义的约束条件。

## 关系操作

### 关系模型的存储结构

在关系数据模型中实体及实体间的联系都是用表来表示，但表只是关系数据的逻辑模型，而不是物理模型。

在实际的关系数据库的物理组织中，
+ 有的关系数据库管理系统中一个表有时会**只对应一个实际的操作系统中的文件**，由操作系统完成其物理数据的组织。
+ 而有的关系数据库管理系统中一个表有时会**对应若干个实际的操作系统中的大文件**，由 DBMS 自己划分文件空间，组织表、索引等存储结构，并由 DBMS 自己进行存储管理，以提高效率。

SQL Server 是第二种类型的 DBMS。

### 基本的关系操作

关系数据模型中常用的关系操作包括：
+ **查询 (query)**，用于从一个或多个关系中提取所需数据；
+ 更新，包括**插入 (insert)**、**删除 (delete)** 和**修改 (update)** 三种操作，用于对关系中的数据进行维护。

关系的查询表达能力非常强大，**[[#并 (union)]]**、**[[#差 (minus)]]**、**[[#Cartesian 积 (cartesian product)]]**、**[[#投影 (project)]]** 和**[[#选择 (select)]]** 5 种操作是关系查询的基本操作，其他操作都可以由这些基本操作导出。

关系操作的特点是**集合操作方式**，即操作的对象和结果都是集合。这种操作方式也称为**一次一集合 (set-at-a-time)**。

### 关系操作的描述

关系操作使用**关系语言 (relational language)** 来描述，具体包括：
+ **[[关系代数]] (relational algebra)**，以**集合**操作为基础；
+ **[[关系演算]] (relational calculus)**，以**谓词逻辑**为基础，又可分为
	+ **元组关系演算 (tuple relational calculus)**，
	+ **[[关系演算#域关系演算语言 QBE|域关系演算]] (domain relational calculus)**；
+ 结构化查询语言 (structured query language, **[[SQL]]**)。

关系语言的描述能力以**关系代数**为基准，一个关系数据语言能够表示所有关系代数操作，则称该语言具有**完备 (complete)** 的表达能力，简称**关系完备性**。
