## 采样率转换

### 整数倍降采样

对离散信号 $x[n]$，考虑**每 $M$ 个值保留 1 个值**，构成新序列
$$
y[n] = x[Mn]
$$
称为 **$M$ 倍抽取 (decimation)**。如果 $x[n] = x_{\mathrm{a}}(nT_{\mathrm{s}})$ 是由某连续时间信号 连续时间信号 $x_{\mathrm{a}}(t)$ 以采样周期 $T_{\mathrm{s}}$ 采样得到的，则 $y[n]$ 可视为对 $x_{\mathrm{a}}(t)$ 以采样周期 $MT_{\mathrm{s}}$ 采样得到的离散信号，即采样率降低为原来的 $\cfrac{1}{M}$。

抽取过程可以通过以下两步实现：
1. 对不需要的离散点**置零**，得到中间序列
$$
x_{M}[n] = x[n] \cdot \sum\limits_{m=-\infty}^{\infty} \delta[n - Mm] \stackrel{\text{Poisson}}{=\! =\! =\! =} x[n] \cdot \dfrac{1}{M} \sum\limits_{k=0}^{M-1} \e^{\J \tfrac{2\pi}{M} kn}
$$
其 $z$ 变换为
$$
\begin{align}
X_{M}(z) &= \sum\limits_{n=-\infty}^{\infty} \left( x[n] \cdot \dfrac{1}{M} \sum\limits_{k=0}^{M-1} \e^{\J \tfrac{2\pi}{M} kn} \right) z^{-n}  \\
&= \dfrac{1}{M} \sum\limits_{k=0}^{M-1} \sum\limits_{n=-\infty}^{\infty} x[n] \left( z \cdot \e^{-\J \tfrac{2\pi}{M} k} \right)^{-n} = \dfrac{1}{M} \sum\limits_{k=0}^{M-1} X\left( z \e^{-\J \tfrac{2\pi}{M} k} \right)
\end{align}
$$
2. 对中间序列进行**压缩**，得到最终序列
$$
y[n] = x_{M}[Mn]
$$
其 $z$ 变换为
$$
\begin{align} 
Y(z) &= \sum\limits_{n=-\infty}^{\infty} x_{M}[Mn] z^{-n} \stackrel{n = \tfrac{m}{M}}{=\! =\! =\! =} \sum\limits_{m=-\infty}^{\infty} x_{M}[m] \left( z^{\tfrac{1}{M}} \right)^{-m} = X_{M}\left( z^{\tfrac{1}{M}} \right) \\
&= \dfrac{1}{M} \sum\limits_{k=0}^{M-1} X\left( z^{\tfrac{1}{M}} \e^{-\J \tfrac{2\pi}{M} k} \right)
\end{align}
$$

注意到，采样率为 $\cfrac{1}{T_{\mathrm{s}}}$ 时满足 Nyquist 采样定理的信号，在采样率为 $\cfrac{1}{MT_{\mathrm{s}}}$ 时可能会发生混叠现象。因此，在抽取前通常需要对信号进行**低通滤波** $X_{\mathrm{LP}}(z) = H_{\mathrm{LP}}(z) X(z)$，以抑制高频成分，防止混叠。 这样，所得信号的 $z$ 变换为
$$
Y(z) = \dfrac{1}{M} \sum\limits_{k=0}^{M-1} H_{\mathrm{LP}} \left( z^{\tfrac{1}{M}} \e^{-\J \tfrac{2\pi}{M} k} \right) X\left( z^{\tfrac{1}{M}} \e^{-\J \tfrac{2\pi}{M} k} \right)
$$
所得的**时域信号**为
$$
y[n] = \sum\limits_{m=-\infty}^{\infty} h_{\mathrm{LP}}[Mn - m] \cdot x[m]
$$

### 整数倍升采样

对离散信号 $x[n]$，类似地考虑以下步骤**提升采样率**：
1. 对每个离散点之间**插入 $L-1$ 个零**，得到中间序列
$$
x_{L} [n] = \begin{cases}
x\left[ \dfrac{n}{L} \right], & n = 0, \pm L, \pm 2L, \cdots \\
0, & \text{otherwise}
\end{cases}
$$
其 $z$ 变换为
$$
X_{L}(z) = \sum\limits_{n=-\infty}^{\infty} x_{L}[n] z^{-n} \stackrel{n=mL}{=\! =\! =\! =} \sum\limits_{m=-\infty}^{\infty} x[m] \left( z^{L} \right)^{-m} = X\left( z^{L} \right)
$$
2. 显然引入了大量高频分量，对中间序列进行**低通滤波**，得到最终序列
$$
y[n] = \sum\limits_{m=-\infty}^{\infty} h_{\mathrm{LP}}[n - m] \cdot x_{L}[m] = \sum\limits_{k=-\infty}^{\infty} h_{\mathrm{LP}}[n - kL] \cdot x[k]
$$
其 $z$ 变换为
$$
Y(z) = H_{\mathrm{LP}}(z) \cdot X\left( z^{L} \right)
$$
其中 $H_{\mathrm{LP}}(\e^{\J\omega})$ 的通带应为 $\left| \omega \right| \leq \cfrac{\pi}{L}$，以滤除插入零点引入的高频成分。

这称为 **$L$ 倍理想插值 (ideal interpolation)**，完整保持了原始频谱的信息。

### 有理数倍采样率转换

对于任意有理数 $\alpha = \cfrac{L}{M}$，可以通过先进行 **$L$ 倍升采样**，再进行 **$M$ 倍降采样**来实现采样率转换。


## 采样率转换的高效实现

### 滤波与抽取/零插的交换

前述[[#整数倍降采样]]和[[#整数倍升采样]]都在**高数据率**下做滤波，其**计算复杂度较高**。我们希望交换低通滤波与抽取/零插的顺序，从而在**低数据率**下做滤波，降低计算复杂度。

可以证明：如果 $M$ 倍降采样前的低通滤波器可以**写成 $H(z^{M})$ 的形式**，则可以**交换低通滤波与抽取**的顺序；如果 $L$ 倍升采样前的低通滤波器可以**写成 $H(z^{L})$ 的形式**，则可以**交换低通滤波与零插**的顺序。
+ 对于 $M$ 倍降采样，
$$
\begin{align} 
Y(z) &= \dfrac{1}{M} \sum\limits_{k=0}^{M-1} H_{\mathrm{LP}} \left( z^{\tfrac{1}{M}} \e^{-\J \tfrac{2\pi}{M} k} \right) X\left( z^{\tfrac{1}{M}} \e^{-\J \tfrac{2\pi}{M} k} \right) \\
&= \dfrac{1}{M} \sum\limits_{k=0}^{M-1} H\left( \left( z^{\tfrac{1}{M}} \e^{-\J \tfrac{2\pi}{M} k} \right)^{M} \right) X\left( z^{\tfrac{1}{M}} \e^{-\J \tfrac{2\pi}{M} k} \right) \\
&= \dfrac{1}{M} \sum\limits_{k=0}^{M-1} H\left( z \e^{-\J 2\pi k} \right) X\left( z^{\tfrac{1}{M}} \e^{-\J \tfrac{2\pi}{M} k} \right)  \\
&= H(z) \cdot \dfrac{1}{M} \sum\limits_{k=0}^{M-1} X\left( z^{\tfrac{1}{M}} \e^{-\J \tfrac{2\pi}{M} k} \right) = H(z) \cdot X_{M}\left( z^{\tfrac{1}{M}} \right)
\end{align}
$$
即等价于抽取结果 $X_{M}\left( z^{\tfrac{1}{M}} \right)$ 经 $H(z)$ 滤波。
+ 对于 $L$ 倍升采样，
$$
Y(z) = H_{\mathrm{LP}}(z) \cdot X\left( z^{L} \right) = H\left( z^{L} \right) \cdot X\left( z^{L} \right)
= \left( H(z') \cdot X(z') \right) \Big|_{z' = z^{L}}
$$
即等价于 $X(z)$ 经 $H(z)$ 滤波后再进行 $L$ 倍零插。

### 采样率的级联转换

当降/升采样率**变化比例较大**时，抗混叠滤波设计实现较为困难，可考虑采用**级联实现**降低计算量。

> [!example] CIC 滤波器
> **积分器—梳状滤波器级联 (cascaded integrator-comb, CIC) 系统**是一种常用的多采样率转换结构，适用于大倍率的升/降采样率转换。CIC 系统由多个积分器级联和多个梳状滤波器级联组成，且不需要乘法运算，计算复杂度低，非常适合硬件实现。

### 多相滤波器结构

单通道滤波器在多采样率处理中的计算效率较低，可采用**多相滤波器结构 (polyphase filter structure)** 提高计算效率。考虑
$$
\begin{align}
X(z) &= \sum\limits_{n=-\infty}^{\infty} x[n] z^{-n} \stackrel{n=kL+m}{=\! =\! =\! =\! =\! =} \sum\limits_{k=-\infty}^{\infty} \sum\limits_{m=0}^{L-1} x[kL + m] z^{-(kL + m)} \\
&= \sum\limits_{m=0}^{L-1} z^{-m} \left( \sum\limits_{k=-\infty}^{\infty} x[kL + m] \left( z^{L} \right)^{-k} \right) = \sum\limits_{m=0}^{L-1} z^{-m} X_{m}\left( z^{L} \right)
\end{align}
$$
即分解为 $L$ 相子序列的和，称为**信号的多相分解**，其中 $X_{m}(z) = \sum\limits_{k=-\infty}^{\infty} x[kL + m] z^{-k}$ 是 $x[n]$ 的**第 $m$ 相子序列** $\cdots, x[m], x[L+m], x[2L+m], \cdots$ 的 $z$ 变换。

类似地，**滤波器的多相分解**为
$$
H(z) = \sum\limits_{n=-\infty}^{\infty} h[n] z^{-n} \stackrel{n=kL+m}{=\! =\! =\! =\! =\! =} \sum\limits_{m=0}^{L-1} z^{-m} H_{m}\left( z^{L} \right)
$$
其中 $H_{m}(z) = \sum\limits_{k=-\infty}^{\infty} h[kL + m] z^{-k}$ 是滤波器 $h[n]$ 的**第 $m$ 相子滤波器**。

利用[[#滤波与抽取/零插的交换]]原理，各相子滤波器可与抽取/零插操作交换，从而在低采样率下实现滤波，进一步降低计算复杂度。

## 均匀滤波器组的分解与重构

### 均匀 DFT 滤波器组的分解

使用多路并行的一组滤波器是实现**子带分解**，即将高速率宽带信号**分解为多路低速率窄带信号**的有效方法。

设将**基础低通滤波器 $H_{0}(z)$** 在频率上均匀移位 $N$ 次，得到 $N$ 个滤波器
$$
H_{k}(z) = H_{0}\left( z \cdot \e^{-\J \tfrac{2\pi}{N} k} \right), \qquad k = 0, 1, \cdots, N-1
$$
每个滤波器均作为 $N$ 倍降采样前的抗混叠滤波器，都需接受高速率信号 $X(z)$ 进行滤波，计算复杂度较高，因此考虑使用[[#多相滤波器结构]]进行优化。

将基础低通滤波器 $H_{0}(z)$ 进行 **$N$ 相分解**有
$$
H_{0}(z) = \sum\limits_{m=0}^{N-1} z^{-m} H_{0,m}\left( z^{N} \right)
$$
则每个滤波器 $H_{k}(z)$ 可表示为
$$
\begin{align}
H_{k}(z) &= H_{0}\left( z \cdot \e^{-\J \tfrac{2\pi}{N} k} \right) = \sum\limits_{m=0}^{N-1} \left( z \cdot \e^{-\J \tfrac{2\pi}{N} k} \right)^{-m} H_{0,m}\left( \left( z \cdot \e^{-\J \tfrac{2\pi}{N} k} \right)^{N} \right) \\
&= \sum\limits_{m=0}^{N-1} z^{-m} \e^{\J \tfrac{2\pi}{N} km} H_{0,m}\left( z^{N} \right)
\end{align}
$$
其输出即
$$
H_{k}(z) X(z) = X(z) \sum\limits_{m=0}^{N-1} z^{-m} \e^{\J \tfrac{2\pi}{N} km} H_{0,m}\left( z^{N} \right)
$$
注意到 $H_{0,m}\left( z^{N} \right)$ 结构，对输出做 **$N$ 倍抽取**可与滤波交换，得到**第 $k$ 路的输出**
$$
\begin{align}
Y_{k}(z) &= \dfrac{1}{N} \sum\limits_{l=0}^{N-1} H_{k}\left( z' \right) X\left( z' \right) \Bigg|_{z' = z^{\frac{1}{N}} \e^{-\J \frac{2\pi}{N} l}} \\
&= \dfrac{1}{N} \sum\limits_{l=0}^{N-1} X\left( z^{\tfrac{1}{N}} \e^{-\J \tfrac{2\pi}{N} l} \right)  \\
&\hspace{4.5em} \cdot \sum\limits_{m=0}^{N-1} \left( z^{\tfrac{1}{N}} \e^{-\J \tfrac{2\pi}{N} l} \right)^{-m} \e^{\J \tfrac{2\pi}{N} km} H_{0,m}\left( \left( z^{\tfrac{1}{N}} \e^{-\J \tfrac{2\pi}{N} l} \right)^{N} \right) \\
&= \underbrace{ \sum\limits_{m=0}^{N-1} \e^{\J \tfrac{2\pi}{N} km} \cdot \underbrace{ H_{0,m}(z) \cdot \underbrace{ \dfrac{1}{N} \sum\limits_{l=0}^{N-1} z^{-\tfrac{m}{N}} \e^{\J \tfrac{2\pi}{N} lm} X\left( z^{\tfrac{1}{N}} \e^{-\J \tfrac{2\pi}{N} l} \right) }_{ x[n-m] \text{ 的 } N \text{ 倍抽取} } }_{ \text{抽取后 } H_{0,m}(z) \text{ 滤波} } }_{ \text{DFT} \text{ } (-k) }
\end{align}
$$
设抽取后信号经过滤波器 $H_{0,m}(z)$ 输出的信号为 $v_{m}[n]$，其与第 $k$ 路输出信号 $y_{k}[n]$ 在 **$z$ 变换域**有关系
$$
Y_{k}(z) = \sum\limits_{m=0}^{N-1} \e^{\J \tfrac{2\pi}{N} km} V_{m}(z)
$$
这是索引 $m$ 与索引 $k$ 之间的 DFT 关系（DFT 变换系数中 $k$ 变为 $-k$），即**相 $m$ 域到带 $k$ 域的 DFT 关系**，与 $z$ 无关，因此在**时域**同样有
$$
y_{k}[n] = \sum\limits_{m=0}^{N-1} \e^{\J \tfrac{2\pi}{N} km} v_{m}[n]
$$
即各路输出信号可由各相子滤波器输出信号通过 DFT 变换得到，因此称为**均匀 DFT 滤波器组的分解结构**。

### 均匀 DFT 滤波器组的合成

多路由均匀 DFT 滤波器组分解出的**子带信号**亦可通过升采样后加和构成宽带的**重构信号**。设各路子带信号为 $x_{k}[n]$，则重构信号为
$$
\begin{align}
Y(z) &= \sum\limits_{k=0}^{N-1} Y_{k}(z) = \sum\limits_{k=0}^{N-1} X_{k}\left( z^{N} \right) H_{k}\left( z \right) 
= \sum\limits_{k=0}^{N-1} X_{k}\left( z^{N} \right) \sum\limits_{m=0}^{N-1} z^{-m} \e^{\J \tfrac{2\pi}{N} km} H_{0,m}\left( z^{N} \right) \\
&= \sum\limits_{m=0}^{N-1} z^{-m} H_{0,m}\left( z^{N} \right) \sum\limits_{k=0}^{N-1} \e^{\J \tfrac{2\pi}{N} km} X_{k}\left( z^{N} \right) \\
&= \sum\limits_{m=0}^{N-1} z^{-m} \cdot \underbrace{ \underbrace{ H_{0,m}\left( z' \right) \cdot \underbrace{ \sum\limits_{k=0}^{N-1} \e^{\J \tfrac{2\pi}{N} km} X_{k}\left( z' \right) }_{ \text{IDFT} } }_{ H_{0,m}\left( z \right) \text{ 滤波} } \Bigg|_{z' = z^{N}} }_{ N \text{ 倍零插} }
\end{align}
$$
为与前述 DFT 关系对应，这里认为各子带信号 $x_{k}[n]$ 通过**带 $k$ 域到相 $m$ 域的 IDFT** 得到各相子滤波器输入信号。