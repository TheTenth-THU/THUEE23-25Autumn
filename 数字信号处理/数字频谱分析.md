## DFT 与连续信号频谱的关系

### 直观解释

设有连续时间信号 $s(t)$，对其以采样间隔 $T_{\mathrm{s}}$ 进行采样，得到离散时间信号 $s[n] = s(nT)$。采样信号的 Fourier 变换为
$$
\begin{align}
S_{\mathrm{s}}\left( \varOmega \right) &= \dint_{-\infty}^{\infty} s(t) \sum\limits_{n=-\infty}^{\infty} \delta(t - nT_{\mathrm{s}}) \e^{-\J \varOmega t} \dif t \\
&\mathop{} \begin{aligned} =
\sum\limits_{n=-\infty}^{\infty} \dint_{-\infty}^{\infty} s(t) \delta(t - nT_{\mathrm{s}}) \e^{-\J \varOmega t} \dif t 
&= \sum\limits_{n=-\infty}^{\infty} s(nT_{\mathrm{s}}) \e^{-\J \varOmega nT_{\mathrm{s}}}  \\
&= \sum\limits_{n=-\infty}^{\infty} s[n] \e^{-\J \left( \varOmega T_{\mathrm{s}} \right) n} = S_{\mathrm{D}}( \e^{\J \omega} ) \Big|_{\omega = \varOmega T_{\mathrm{s}}}
\end{aligned} \\
&\mathop{} \begin{aligned} 
= \mathscr{F} \left\{ s(t) \cdot \sum\limits_{n=-\infty}^{\infty} \delta(t - nT_{\mathrm{s}}) \right\} &= \dfrac{1}{2\pi} S\left( \varOmega \right) * \dfrac{2\pi}{T_{\mathrm{s}}} \sum\limits_{k=-\infty}^{\infty} \delta \left( \varOmega - k \dfrac{2\pi}{T_{\mathrm{s}}} \right) \\
&= \sum\limits_{k=-\infty}^{\infty} \dint_{-\infty}^{\infty} S\left( \varOmega' \right) \dfrac{1}{T_{\mathrm{s}}} \delta \left( \varOmega - \varOmega' - k \dfrac{2\pi}{T_{\mathrm{s}}} \right) \dif \varOmega' \\
&= \dfrac{1}{T_{\mathrm{s}}} \sum\limits_{k=-\infty}^{\infty} S\left( \varOmega - k \dfrac{2\pi}{T_{\mathrm{s}}} \right)
\end{aligned}
\end{align}
$$
其中 $S(\varOmega)$ 为连续时间信号 $s(t)$ 的 Fourier 变换，$S_{\mathrm{D}}( \e^{\J \omega} )$ 为离散时间信号 $s[n]$ 的 DTFT。对 DTFT 取分立频点即得到 DFT
$$
\begin{align} 
S_{\mathrm{D}} [k] &= S_{\mathrm{D}} \left( \e^{\J \omega} \right) \Big|_{\omega = 2\pi \tfrac{k}{N}} = \dfrac{1}{T_{\mathrm{s}}} \sum\limits_{m=-\infty}^{\infty} S\left( \varOmega - m \dfrac{2\pi}{T_{\mathrm{s}}} \right) \Bigg|_{\varOmega = 2\pi \tfrac{k}{N T_{\mathrm{s}}}} \\
&= \dfrac{1}{T_{\mathrm{s}}} \sum\limits_{m=-\infty}^{\infty} S\left( 2\pi \left( \dfrac{k}{N T_{\mathrm{s}}} - \dfrac{m}{T_{\mathrm{s}}} \right) \right) \\
\end{align}
$$

显见，连续时间信号频谱 $S(\varOmega)$ 在以 $\dfrac{2\pi}{T_{\mathrm{s}}}$ 为周期混叠，DFT 频点 $k$ 对应 DTFT 频率 $\omega = 2\pi \dfrac{k}{N}$，亦即对应连续时间频率 $\varOmega = 2\pi \dfrac{k}{N T_{\mathrm{s}}}$。

### 解析解释

对连续信号 $s(t) = \cfrac{1}{2\pi} \dint_{-\infty}^{\infty} S(\varOmega) \e^{\J \varOmega t} \dif \varOmega$ 进行采样，得到离散时间信号
$$
s[n] = s(nT_{\mathrm{s}}) = \dfrac{1}{2\pi} \dint_{-\infty}^{\infty} S(\varOmega) \e^{\J \varOmega n T_{\mathrm{s}}} \dif \varOmega
$$
截取 $n = 0, 1, \cdots, M-1$ 点，做 $N$ 点 DFT，得到
$$
\begin{align}
X[k] &= \sum\limits_{n=0}^{M-1} s[n] W_{N}^{kn} = \dfrac{1}{2\pi} \sum\limits_{n=0}^{M-1} \e^{-\J 2\pi \tfrac{kn}{N}} \dint_{-\infty}^{\infty} S\left( \varOmega \right) \e^{\J \varOmega n T_{\mathrm{s}}} \dif \varOmega \\
&= \dfrac{1}{2\pi} \dint_{-\infty}^{\infty} S\left( \varOmega \right) \underbrace{ \sum\limits_{n=0}^{M-1} \e^{\J n \left( \varOmega T_{\mathrm{s}} - 2\pi \tfrac{k}{N} \right)} }_{ \psi_{M,N,k}\left( \varOmega \right) } \dif \varOmega
\end{align}
$$
其中，**对 $S\left( \varOmega \right)$ 做加权积分**的**权函数**为
$$
\begin{align} 
\psi_{M,N,k}\left( \varOmega \right) &= \sum\limits_{n=0}^{M-1} \e^{\J n \left( \varOmega T_{\mathrm{s}} - 2\pi \tfrac{k}{N} \right)}  \\
&= \dfrac{\sin \left( \cfrac{M}{2} \left( \varOmega T_{\mathrm{s}} - 2\pi \cfrac{k}{N} \right) \right)}{\sin \left( \cfrac{1}{2} \left( \varOmega T_{\mathrm{s}} - 2\pi \cfrac{k}{N} \right) \right)} \e^{\J \tfrac{M-1}{2} \left( \varOmega T_{\mathrm{s}} - 2\pi \tfrac{k}{N} \right)} 
\end{align}
$$

#### 理解 1：对连续时间信号频谱的采样

理想情况下，对 $s(t)$ 频谱 $S\left( \varOmega \right)$ 的**理想采样**应为
$$
X_{\mathrm{ideal}} [k] = S\left( \varOmega \right) \Big|_{\varOmega = 2\pi \tfrac{k}{N T_{\mathrm{s}}}}
= \dint_{-\infty}^{\infty} S\left( \varOmega \right) \delta \left( \varOmega - 2\pi \dfrac{k}{N T_{\mathrm{s}}} \right) \dif \varOmega
$$
实际的采样函数 $\cfrac{1}{2\pi} \psi_{M,N,k}\left( \varOmega \right)$ 可视为对理想采样函数 $\delta \left( \varOmega - 2\pi \dfrac{k}{N T_{\mathrm{s}}} \right)$ 的一种**逼近**，随着 $M$ 增大，其主瓣变窄，旁瓣减小，更加接近理想采样。

#### 理解 2：滤波器组的输出

上面的频谱
$$
\begin{align} 
X[k] &= \dfrac{1}{2\pi} \dint_{-\infty}^{\infty} S\left( \varOmega \right) \psi_{M,N,k}\left( \varOmega \right) \dif \varOmega \\
&= \dfrac{1}{2\pi} \dint_{-\infty}^{\infty} S\left( \varOmega \right) \psi_{M,N,k}\left( \varOmega \right) \e^{\J t \varOmega} \dif \varOmega \bigg|_{t=0} 
= \mathscr{F}^{-1} \left\{ S\left( \varOmega \right) \psi_{M,N,k}\left( \varOmega \right) \right\} \Big|_{t=0} 
\end{align}
$$
可视为对连续时间信号 $s(t)$ 通过一组滤波器组后在 $t=0$ 时刻的输出，第 $k$ 个滤波器的频率响应为 $\psi_{M,N,k}\left( \varOmega \right)$，对应时域冲激响应为
$$
h_{M,N,k}(t) = \sum\limits_{n=0}^{M-1} \e^{-\J 2\pi \tfrac{kn}{N}} \delta(t - nT_{\mathrm{s}})
$$

#### 理解 3：无限长离散信号加矩形窗

设有无限长离散信号 $s[n]$，其 DTFT 为 $S_{\mathrm{D}}(\omega)$。对其进行矩形窗截断，得到长度为 $M$ 的有限长信号
$$
s_{M}[n] = s[n] R_{M}[n], \qquad R_{M}[n] = u[n] - u[n - M]
$$
则其 DTFT 为
$$
\begin{align} 
S_{M}(\omega) &= S_{\mathrm{D}}(\omega) * \mathrm{DTFT}\{ R_{M}[n] \} = S_{\mathrm{D}}(\omega) * \sum\limits_{n=0}^{M-1} \e^{-\J\omega n} \\
&= S_{\mathrm{D}}(\omega) * \cfrac{\sin \cfrac{M \omega}{2}}{\sin \cfrac{\omega}{2}} \e^{-\J \tfrac{(M-1)\omega}{2}} \\
\end{align}
$$
对其在 $0 \sim 2\pi$ 范围内均匀采样 $N$ 点（$M$ 不一定等于 $N$），即得到 DFT
$$
\begin{align}
X[k] &= S_{M}(\omega) \Big|_{\omega = 2\pi \tfrac{k}{N}} = \dint_{-\pi}^{\pi} S_{\mathrm{D}}(\omega') \cdot \cfrac{\sin \left( \cfrac{M}{2} \left( \omega - \omega' \right) \right)}{\sin \left( \cfrac{1}{2} \left( \omega - \omega' \right) \right)} \e^{-\J \tfrac{(M-1)}{2} \left( \omega - \omega' \right)} \dif \omega' \Bigg|_{\omega = 2\pi \tfrac{k}{N}} \\
&= \dint_{-\pi}^{\pi} S_{\mathrm{D}}(\omega') \cdot \cfrac{\sin \left( \cfrac{M}{2} \left( \omega' - \omega \right) \right)}{\sin \left( \cfrac{1}{2} \left( \omega' - \omega \right) \right)} \e^{\J \tfrac{(M-1)}{2} \left( \omega' - \omega \right)} \dif \omega' \Bigg|_{\omega = 2\pi \tfrac{k}{N}} \\
&\stackrel{\omega' = \varOmega T_{\mathrm{s}}}{=\!=\!=\!=\!=} T_{\mathrm{s}} \dint_{-\pi}^{\pi} S_{\mathrm{D}}\left( \varOmega T_{\mathrm{s}} \right) \cdot \cfrac{\sin \left( \cfrac{M}{2} \left( \varOmega T_{\mathrm{s}} - 2\pi \cfrac{k}{N} \right) \right)}{\sin \left( \cfrac{1}{2} \left( \varOmega T_{\mathrm{s}} - 2\pi \cfrac{k}{N} \right) \right)} \e^{\J \tfrac{(M-1)}{2} \left( \varOmega T_{\mathrm{s}} - 2\pi \tfrac{k}{N} \right)} \dif \varOmega \\
&= \dfrac{1}{2\pi} \dint_{-\pi}^{\pi} \left( 2\pi T_{\mathrm{s}} S_{\mathrm{D}}\left( \varOmega T_{\mathrm{s}} \right) \right) \cdot \psi_{M,N,k}\left( \varOmega \right) \dif \varOmega
\end{align}
$$

## 用 DFT (FFT) 进行频谱分析

### 抗混叠滤波

实际连续信号一般不满足**带限 (bandlimited)** 条件，需先通过**抗混叠滤波器 (anti-aliasing filter)** 限制信号带宽，避免混叠失真。

设[[#采样]]环节的采样率为 $f_{\mathrm{s}}$，则抗混叠滤波器的截止频率须取为 $B_{\text{pass}} < \dfrac{f_{\mathrm{s}}}{2}$。

### 采样

采样环节将连续时间信号 $s(t)$ 以采样间隔 $T_{\mathrm{s}} = \dfrac{1}{f_{\mathrm{s}}}$ 进行采样，得到离散时间信号 $x[n] = s(nT_{\mathrm{s}})$。

### 截取、加窗

实际参加频谱分析的信号长度有限，需对离散时间信号进行**截取**，得到有限长信号 $x_{M}[n] = x[n] R_{M}[n]$。为减小截断引起的**频谱泄漏 (spectral leakage)**，通常会对有限长信号进行**时域加窗**处理，对应地在频域即卷积以**频率采样函数**，从而减小旁瓣泄漏的影响。

截取 $M$ 点即等效于**乘以矩形窗 $R_{M}[n]$**，其对应的频率采样函数为
$$
\t{R}_{M}(\omega) = \sum\limits_{n=0}^{M-1} \e^{-\J \omega n} = \cfrac{\sin \left( \cfrac{M \omega}{2} \right)}{\sin \left( \cfrac{\omega}{2} \right)} \e^{-\J \tfrac{(M-1)\omega}{2}}
$$
常用的窗函数如 **Hanning 窗**
$$
w[n] = \dfrac{1}{2} \left( 1 - \cos \dfrac{2\pi n}{M} \right), \quad 0 \le n \le M-1
$$
和 **Hamming 窗**
$$
w[n] = 0.54 - 0.46 \cos \dfrac{2\pi n}{M}, \quad 0 \le n \le M-1
$$

我们使用**旁瓣高度**和 **3 dB 主瓣展宽**来评价窗函数的频率特性：
+ **旁瓣高度 (side lobe level)**：窗函数频谱中主瓣之外**最高旁瓣与主瓣峰值之比**，通常以 dB 为单位表示。旁瓣高度越低，频谱泄漏越小。
+ **3 dB 主瓣展宽 (3 dB main lobe width)**：窗函数频谱中主瓣在峰值处下降 3 dB 所对应的频率宽度。主瓣展宽越小，频率分辨力损失越小。

| 窗函数           | 旁瓣高度 (dB) | 3 dB 主瓣展宽 ($\times \cfrac{2\pi}{MT_{\mathrm{s}}}$) |
| :------------ | :-------- | :------------------------------------------------- |
| 矩形窗           | $-13$     | 0.89                                               |
| 三角窗           | $-25$     | 1.28                                               |
| **Hanning 窗** | $-31$     | 1.44                                               |
| **Hamming 窗** | $-41$     | 1.30                                               |
| Blackman 窗    | $-57$     | 1.68                                               |

### 频谱显示

对截取并加窗后的有限长信号 $x_{M}[n]$ 进行 FFT，即得到其 DFT 频谱 $X_{M}[k]$。若想更加「精细」地显示频谱，可以通过**零填充 (zero padding)** 的方式增加 FFT 点数 $N$（$N > M$），使得频谱显示更加平滑。

$M$ 点离散时间信号的 DTFT 频谱由 $M$ 点 DFT **完全表示**，因此这一过程本质上并没有增加频谱信息，只是一种**插值**手段。注意到
$$
\begin{align} 
X_{M}(\omega) &= \sum_{n=0}^{M-1} x_{M}[n] \e^{-\J \omega n} = \sum\limits_{n=0}^{M-1} \left( \dfrac{1}{N} \sum\limits_{k=0}^{N-1} X_{M}[k] \e^{\J 2\pi \tfrac{kn}{N}} \right) \e^{-\J \omega n} \\
&= \sum\limits_{k=0}^{N-1} X_{M}[k] \sum\limits_{n=0}^{M-1} \dfrac{1}{N} \e^{-\J n \left( \omega - 2\pi \tfrac{k}{N} \right)} \\
&= \sum\limits_{k=0}^{N-1} X_{M}[k] \cdot \mark{ \e^{-\J \tfrac{M-1}{2} \left( \omega - 2\pi \tfrac{k}{M} \right)} \cdot \dfrac{\sin \left( \dfrac{M}{2} \left( \omega - \dfrac{2\pi k}{N} \right) \right)}{\sin \left( \dfrac{1}{2} \left( \omega - \dfrac{2\pi k}{N} \right) \right)} }
\end{align}
$$
可见，零填充后的频谱 $X_{M}(\omega)$ 可视为对 DFT 频点 $X_{M}[k]$ 进行**加权插值**得到的连续频谱，其权函数与截断窗的频率采样函数相同。这一过程称为 **Shannon 插值**。