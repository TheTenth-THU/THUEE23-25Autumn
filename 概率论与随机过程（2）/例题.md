## L10 (10/30)

**Gauss 条件分布算例。** 
设 $X_{1}, X_{2} \stackrel{\text{i.i.d.}}{\sim} \mathscr{N}(0, 1)$，尝试求解以下条件期望。

### L10-1

**$\mathbb{E} \left[ X_{1}-X_{2}\mid X_{1}+X_{2} \right]$。**

注意到
$$
\begin{pmatrix}
X_{1} + X_{2} \\ X_{1} - X_{2}
\end{pmatrix} = \begin{pmatrix}
1 & 1 \\ 1 & -1
\end{pmatrix} \begin{pmatrix}
X_{1} \\ X_{2}
\end{pmatrix}
$$
由于 $X_{1}, X_{2}$ 独立同分布为 Gauss 分布，故 $\begin{pmatrix} X_{1} + X_{2} \\ X_{1} - X_{2} \end{pmatrix}$ 也服从 Gauss 分布，且
$$
\begin{align}
&\v{\mu} = \begin{pmatrix}
1 & 1 \\ 1 & -1
\end{pmatrix} \begin{pmatrix}
0 \\ 0
\end{pmatrix} = \begin{pmatrix}
0 \\ 0
\end{pmatrix} \\
&\boldsymbol{\varSigma} = \begin{pmatrix}
1 & 1 \\ 1 & -1
\end{pmatrix} \begin{pmatrix}
1 & 0 \\ 0 & 1
\end{pmatrix} \begin{pmatrix}
1 & 1 \\ 1 & -1
\end{pmatrix}^{\mathrm{T}} = \begin{pmatrix}
2 & 0 \\ 0 & 2
\end{pmatrix}
\end{align}
$$
因此，依据多元 Gauss 分布各块间的条件分布，有
$$
\mathbb{E} \left[ X_{1}-X_{2}\mid X_{1}+X_{2} = s \right] = 0 + \dfrac{0}{2} (s - 0) = 0
$$

### L10-2

**$\mathbb{E} \left[ (X_{1}-X_{2})^{2} \mid X_{1}+X_{2} \right]$。**

注意到 $\boldsymbol{\varSigma}$ 为对角矩阵，故 $X_{1} - X_{2}$ 与 $X_{1} + X_{2}$ 独立，因此
$$
\mathbb{E} \left[ (X_{1}-X_{2})^{2} \mid X_{1}+X_{2} \right] = \mathbb{E} \left[ (X_{1}-X_{2})^{2} \right] = \mathrm{Var}(X_{1}-X_{2}) = 2
$$

### L10-3

**$\mathbb{E} \left[ (X_{1}-X_{2})^{2n} \mid X_{1}+X_{2} \right]$，$n \in \mathbb{N}^{*}$。**

类似地，由于 $X_{1} - X_{2}$ 与 $X_{1} + X_{2}$ 独立，$\mathbb{E} \left[ (X_{1}-X_{2})^{2n} \mid X_{1}+X_{2} \right] = \mathbb{E} \left[ (X_{1}-X_{2})^{2n} \right]$，而 $X_{1}-X_{2} \sim \mathscr{N}(0, 2)$，因此所求即为 $Y \sim \mathscr{N}(0, 2)$ 的 $2n$ 阶矩，即
$$
\begin{align}
\mathbb{E} \left[ Y^{2n} \right] &= \dfrac{1}{\sqrt{2\pi} \sigma} \dint_{-\infty}^{\infty} y^{2n} \exp\left( -\dfrac{y^{2}}{2\sigma^{2}} \right) \dif y = \dfrac{-\sigma^{2}}{\sqrt{2\pi} \sigma} \dint_{-\infty}^{\infty} y^{2n-1} \dif \exp\left( -\dfrac{y^{2}}{2\sigma^{2}} \right) \\
&= \dfrac{\sigma^{2}}{\sqrt{2\pi} \sigma} \dint_{-\infty}^{\infty} \left( 2n - 1 \right) y^{2n-2} \exp\left( -\dfrac{y^{2}}{2\sigma^{2}} \right) \dif y \\
&= \sigma^{2} \left( 2n - 1 \right) \mathbb{E} \left[ Y^{2(n-1)} \right] = \cdots = \sigma^{2n} (2n - 1)!! = 2^{n} (2n - 1)!!
\end{align}
$$

### L10-4

**$\mathbb{E} \left[ X_1^2 + X_2^2 \mid X_1 + X_2 \right]$。**

**法一**：由期望的线性性，
$$
\mathbb{E} \left[ X_1^2 + X_2^2 \mid X_1 + X_2 \right] = \mathbb{E} \left[ X_1^2 \mid X_1 + X_2 \right] + \mathbb{E} \left[ X_2^2 \mid X_1 + X_2 \right]
$$
注意到类似地有
$$
\begin{pmatrix}
X_{1} + X_{2} \\ X_{1}
\end{pmatrix} = \begin{pmatrix}
1 & 1 \\ 1 & 0
\end{pmatrix} \begin{pmatrix}
X_{1} \\ X_{2}
\end{pmatrix}
\sim \mathscr{N} \left( \begin{pmatrix}
0 \\ 0
\end{pmatrix}, \begin{pmatrix}
2 & 1 \\ 1 & 1
\end{pmatrix} \right) 
$$
则
$$
\begin{align}
&\mathbb{E} \left[ X_{1} \mid X_{1}+X_{2} \right] = 0 + \dfrac{1}{2} (X_{1}+X_{2} - 0) = \dfrac{X_{1}+X_{2}}{2} \\
&\mathrm{Var} \left[ X_{1} \mid X_{1}+X_{2} \right] = 1 - \dfrac{1^{2}}{2} = \dfrac{1}{2}
\end{align}
$$
因此
$$
\mathbb{E} \left[ X_1^2 \mid X_1 + X_2 \right] = \mathrm{Var} \left[ X_{1} \mid X_{1}+X_{2} \right] + \left( \mathbb{E} \left[ X_{1} \mid X_{1}+X_{2} \right] \right)^{2} = \dfrac{1}{2} + \dfrac{(X_{1}+X_{2})^{2}}{4}
$$

**法二**：注意到所求式可拆成分别关于 $X_{1}+X_{2}$ 和 $X_{1}-X_{2}$ 两独立变量的函数，因而可写成
$$
\begin{align}
\mathbb{E} \left[ X_{1}^{2} + X_{2}^{2} \mid X_{1} + X_{2} \right] &= \mathbb{E} \left[ \dfrac{1}{2} (X_{1} + X_{2})^{2} + \dfrac{1}{2} (X_{1} - X_{2})^{2} \,\Bigg|\, X_{1} + X_{2} \right] \\
&= \dfrac{1}{2} (X_{1} + X_{2})^{2} + \dfrac{1}{2} \mathbb{E} \left[ (X_{1} - X_{2})^{2} \right] \\
&= \dfrac{1}{2} (X_{1} + X_{2})^{2} + \dfrac{1}{2} \cdot 2 \\
&= \dfrac{1}{2} (X_{1} + X_{2})^{2} + 1
\end{align}
$$

### L10-5

**$\mathbb{E} \left[ \exp\left( 2X_1 - X_2 \right) \mid X_1 + X_2 \right]$。**

类似地，注意到
$$
\begin{pmatrix}
X_{1} + X_{2} \\ 2X_{1} - X_{2}
\end{pmatrix} = \begin{pmatrix}
1 & 1 \\ 2 & -1
\end{pmatrix} \begin{pmatrix}
X_{1} \\ X_{2}
\end{pmatrix} \sim \mathscr{N} \left( \begin{pmatrix}
0 \\ 0
\end{pmatrix}, \begin{pmatrix}
2 & 1 \\ 1 & 5
\end{pmatrix} \right) 
$$
即
$$
\begin{align}
&\mathbb{E} \left[ 2X_{1} - X_{2} \mid X_{1}+X_{2} \right] = 0 + \dfrac{1}{2} (X_{1}+X_{2} - 0) = \dfrac{X_{1}+X_{2}}{2} \\
&\mathrm{Var} \left[ 2X_{1} - X_{2} \mid X_{1}+X_{2} \right] = 5 - \dfrac{1^{2}}{2} = \dfrac{9}{2}
\end{align}
$$
$2X_{1} - X_{2} \mid X_{1}+X_{2}$ 服从 Gauss 分布 $\mathscr{N} \left( \dfrac{X_{1}+X_{2}}{2}, \dfrac{9}{2} \right)$，不妨记之为 $Y$。

引入**特征函数**，有
$$
\begin{align}
\mathbb{E} \left[ \exp(Y) \right] &= \mathbb{E} \left[ \exp(\J\omega Y) \right] \Big|_{\omega = -\J} = \phi_{Y}(-\J) \\
&= \exp\left( \J \omega \mu_{Y} - \dfrac{1}{2} \sigma_{Y}^{2} \omega^{2} \right) \Big|_{\omega = -\J} = \exp\left( \mu_{Y} + \dfrac{1}{2} \sigma_{Y}^{2} \right) \\
&= \exp\left( \dfrac{X_{1}+X_{2}}{2} + \dfrac{9}{4} \right)
\end{align}
$$

### L10-6

**$\mathbb{E} \left[ \exp(2X_{1}^{2} + X_{2}^{2}) \mid X_{1} - X_{2} \right]$。**

$2X_{1}^{2} + X_{2}^{2}$ 与 $X_{1} - X_{2}$ 并非线性相关，无法直接应用多元 Gauss 分布各块间的条件分布定理。考察
$$
\begin{pmatrix}
X_{1} \\ X_{2} \\ X_{1} - X_{2}
\end{pmatrix} = \begin{pmatrix}
1 & 0 \\ 0 & 1 \\ 1 & -1
\end{pmatrix} \begin{pmatrix}
X_{1} \\ X_{2}
\end{pmatrix} \sim \mathscr{N} \left( \begin{pmatrix}
0 \\ 0 \\ 0
\end{pmatrix}, \begin{pmatrix}
1 & 0 & 1 \\ 0 & 1 & -1 \\ 1 & -1 & 2
\end{pmatrix} \right)
$$
这样有
$$
\begin{align}
&\mathbb{E} \left[ \begin{pmatrix}
X_{1} \\ X_{2}
\end{pmatrix} \,\Bigg|\, X_{1} - X_{2} \right] = \begin{pmatrix}
0 \\ 0
\end{pmatrix} + \begin{pmatrix}
1 \\ -1
\end{pmatrix} \dfrac{1}{2} (X_{1} - X_{2} - 0) = \dfrac{X_{1} - X_{2}}{2} \begin{pmatrix}
1 \\ -1
\end{pmatrix} \\
&\mathrm{Var} \left[ \begin{pmatrix}
X_{1} \\ X_{2}
\end{pmatrix} \,\Bigg|\, X_{1} - X_{2} \right] = \begin{pmatrix}
1 & 0 \\ 0 & 1
\end{pmatrix} - \begin{pmatrix}
1 \\ -1
\end{pmatrix} \dfrac{1}{2} \begin{pmatrix}
1 & -1
\end{pmatrix} = \dfrac{1}{2} \begin{pmatrix}
1 & 1 \\ 1 & 1
\end{pmatrix}
\end{align}
$$
因此，$\begin{pmatrix} X_{1} \\ X_{2} \end{pmatrix} \mid X_{1} - X_{2}$ 服从二维 Gauss 分布
$$
\begin{align} 
&f_{\begin{pmatrix} X_{1} \\ X_{2} \end{pmatrix} \mid X_{1} - X_{2}} \left( \begin{pmatrix} x_{1} \\ x_{2} \end{pmatrix} \,\Bigg|\, s \right)  \\
&= k \exp\left( -\dfrac{1}{2} \left( \begin{pmatrix} x_{1} \\ x_{2} \end{pmatrix} - \dfrac{s}{2} \begin{pmatrix} 1 \\ -1 \end{pmatrix} \right)^{\mathrm{T}} \cdot 2 \begin{pmatrix} 1 & -1 \\ -1 & 1 \end{pmatrix} \cdot \left( \begin{pmatrix} x_{1} \\ x_{2} \end{pmatrix} - \dfrac{s}{2} \begin{pmatrix} 1 \\ -1 \end{pmatrix} \right) \right) 
\end{align}
$$
此即关于 $X_{1},X_{2}$ 的联合 Gauss 分布 $f_{X_{1}, X_{2} \mid X_{1} - X_{2}}$，因而
$$
\begin{align} 
&\mathbb{E} \left[ \exp(2X_{1}^{2} + X_{2}^{2}) \mid X_{1} - X_{2} = s \right]  \\
&= \dint_{-\infty}^{\infty} \dint_{-\infty}^{\infty} \exp(2x_{1}^{2} + x_{2}^{2}) \cdot f_{X_{1}, X_{2} \mid X_{1} - X_{2}} \left( x_{1}, x_{2} \mid s \right) \dif x_{1} \dif x_{2}  
\end{align}
$$

### L10-7

**$\mathbb{E} \left[ \sin (2X_{1} - X_{2}) \mid X_{1} + X_{2} \right]$。**

同上可设 $Y = 2X_{1} - X_{2} \mid X_{1}+X_{2} \sim \mathscr{N} \left( \dfrac{X_{1}+X_{2}}{2}, \dfrac{9}{2} \right)$。同样引入**特征函数**，有
$$
\begin{align}
\mathbb{E} \left[ \sin(Y) \right] &= \dfrac{1}{2\J} \left( \mathbb{E} \left[ \exp(\J Y) \right] - \mathbb{E} \left[ \exp(-\J Y) \right] \right) \\
&= \dfrac{1}{2\J} \left( \phi_{Y}(1) - \phi_{Y}(-1) \right) \\
\end{align}
$$

> [!note] 特征函数在 Gauss 条件分布问题中的更多用法
> 设 $\begin{pmatrix}X_{1} \\ X_{2}\end{pmatrix} \sim \mathscr{N}\left( \begin{pmatrix}0 \\ 0\end{pmatrix}, \begin{pmatrix}2 & 1 \\ 1 & 2\end{pmatrix} \right)$，考虑 **$\mathbb{E} \left[ X_{1} \sin X_{2} \right]$**，有
> $$
> \begin{align}
> \mathbb{E} \left[ X_{1} \sin X_{2} \right] &= \mathbb{E} \left[ X_{1} \cdot \dfrac{1}{2\J} \left( \exp(\J X_{2}) - \exp(-\J X_{2}) \right) \right] \\
> &= \dfrac{1}{2\J} \left( \mathbb{E} \left[ X_{1} \exp(\J X_{2}) \right] - \mathbb{E} \left[ X_{1} \exp(-\J X_{2}) \right] \right) \\
> &= \mathbb{E} \left[ \dfrac{1}{\J} \dfrac{ \partial }{ \partial \omega_{1} } \exp(\J(\omega_{1}X_{1} + \omega_{2}X_{2})) \right] \Bigg|_{\omega_{1}=0, \omega_{2}=1}
> \end{align}
> $$
> 考虑 **$\mathbb{E} \left[ \sin (X_{1})X_{2}\sin(X_{3}) \right]$**，有
> $$
> \begin{align}
> &\mathbb{E} \left[ \sin (X_{1})X_{2}\sin(X_{3}) \right]  \\
> &= \mathbb{E} \left[ \dfrac{1}{(2\J)^{2}} \left( \exp(\J X_{1}) - \exp(-\J X_{1}) \right) X_{2} \left( \exp(\J X_{3}) - \exp(-\J X_{3}) \right) \right] \\
> &= \dfrac{1}{\J} \dfrac{ \partial }{ \partial \omega_{2} } \mathbb{E} \left[ \dfrac{1}{(2\J)^{2}} \exp(\J(\omega_{1}X_{1} + \omega_{2}X_{2} + \omega_{3}X_{3})) \right] \Bigg|_{\omega_{1}=1, \omega_{2}=0, \omega_{3}=1} \\
> \end{align}
> $$

## L14 (11/18)

### L14-1

**Poisson 过程的独立稀释。**

设自某时刻起走进学校的学生数服从参数为 $\lambda$ 的 Poisson 过程，其中每个学生独立以概率 $p$ 为男生，$1-p$ 为女生。求在时间 $t$ 内走进学校的男生数的分布。

对第 $k$ 个走进学校的学生，记 $X_{k} = \begin{cases}1, &\text{if Male}, \\ 0, &\text{if Female}\end{cases}$，则 **$X_{k} \stackrel{\text{i.i.d}}{\sim} \begin{pmatrix}1 & 0 \\ p &1-p \end{pmatrix}$**，时间 $t$ 内走进学校的男生数为 **$X(t) = \sum\limits_{k=1}^{N(t)} X_{k}$**，其中 $N(t) \sim \text{Poisson}(\lambda t)$。$X(t)$ 为一个[[Poisson 过程#复合 Poisson 过程|复合 Poisson 过程]]，其矩母函数为
$$
\begin{align} 
G_{X(t)}(z) &= G_{N(t)}(G_{X_{k}}(z)) = \exp(\lambda t(G_{X_{k}}(z) - 1)) \\
&= \exp(\lambda t(pz^{1} + (1-p)z^{0} - 1)) = \exp(\lambda p t  (z-1))
\end{align}
$$
因此，时间 $t$ 内走进学校的男生数是一个**参数为 $\lambda p$ 的 Poisson 过程**。

进一步地，可见**从参数为 $\lambda$ 的 Poisson 过程中独立地以概率 $p$ 抽取事件，得到的子过程是参数为 $\lambda p$ 的 Poisson 过程**。

### L14-2

**Poisson 过程的和与差。**

设 $N_{1}(t)$ 和 $N_{2}(t)$ 是两个独立的 Poisson 过程，参数分别为 $\lambda_{1}$ 和 $\lambda_{2}$。求 $N(t) = N_{1}(t) + N_{2}(t)$ 和 $M(t) = N_{1}(t) - N_{2}(t)$ 的分布。

对二者之和 $N(t)$，其矩母函数为
$$
\begin{align}
G_{N(t)}(z) &= \mathbb{E} \left[ z^{N(t)} \right] = \mathbb{E} \left[ z^{N_{1}(t) + N_{2}(t)} \right] = \mathbb{E} \left[ z^{N_{1}(t)} \right] \mathbb{E} \left[ z^{N_{2}(t)} \right]   \\
&= G_{N_{1}(t)}(z) \cdot G_{N_{2}(t)}(z) = \exp(\lambda_{1} t (z-1)) \cdot \exp(\lambda_{2} t (z-1)) \\
&= \exp((\lambda_{1} + \lambda_{2}) t (z-1))
\end{align}
$$
即 $N(t)$ 是一个**参数为 $\lambda_{1} + \lambda_{2}$ 的 Poisson 过程**。

对二者之差 $M(t)$，显然 $P \left\{ X(t) < 0 \right\} > 0$ 其矩母函数为
$$
\begin{align}
G_{M(t)}(z) &= \mathbb{E} \left[ z^{M(t)} \right] = \mathbb{E} \left[ z^{N_{1}(t) - N_{2}(t)} \right] = \mathbb{E} \left[ z^{N_{1}(t)} \right] \mathbb{E} \left[ z^{-N_{2}(t)} \right]   \\
&= G_{N_{1}(t)}(z) \cdot G_{N_{2}(t)}\left( \dfrac{1}{z} \right) = \exp(\lambda_{1} t (z-1)) \cdot \exp\left(\lambda_{2} t \left(\dfrac{1}{z} - 1\right)\right) \\
&= \exp\left(\lambda_{1} t (z-1) + \lambda_{2} t \left(\dfrac{1}{z} - 1\right)\right) \\
&= \exp\left((\lambda_{1} + \lambda_{2}) t \left(\dfrac{\lambda_{1}}{\lambda_{1} + \lambda_{2}} z^{1} + \dfrac{\lambda_{2}}{\lambda_{1} + \lambda_{2}} z^{-1} - 1\right)\right)
\end{align}
$$
可见 $M(t)$ 不是 Poisson 过程，而是一个**复合 Poisson 过程**，其每次跳变的增量服从分布 $\begin{pmatrix}1 & -1 \\ \cfrac{\lambda_{1}}{\lambda_{1} + \lambda_{2}} & \cfrac{\lambda_{2}}{\lambda_{1} + \lambda_{2}} \end{pmatrix}$，跳变发生的次数服从参数为 $\lambda_{1} + \lambda_{2}$ 的 Poisson 过程。

### L14-3

设某公交车到站的事件服从参数为 $\lambda$ 的 Poisson 过程。

1. 从第 2 次公交车到站开始算起，5 min 内有第 4 次公交车到站的概率为
$$
\begin{align} 
P \left\{ N(5) - N(0) \ge 2 \right\} &= 1 - P \left\{ N(5) = 0 \right\} - P \left\{ N(5) = 1 \right\}  \\
&= 1 - \e^{-5\lambda} - 5\lambda \e^{-5\lambda} 
\end{align}
$$

2. 已知 10 min 内有 20 辆车到站，求至第 15 min 时累计到站的公交车数 $X$ 的分布。
考虑 $X = ( N(15) \mid N(10) = 20) = 20 + (N(15) - N(10) \mid N(10) = 20)$，由 Poisson 过程的**增量独立性**，其中 $N(15) - N(10) \sim \text{Poisson}(5\lambda)$ 与 $N(10)$ 独立，因此
$$
\begin{align} 
P \left\{ X = k \right\} &= P \left\{ N(15) - N(10) = k-20 \right\}  \\
&= \begin{cases}
0, & k < 20,  \\
\dfrac{(5\lambda)^{k-20}}{(k-20)!} \e^{-5\lambda}, & k \ge 20
\end{cases} 
\end{align}
$$

3. 已知 10 min 内有 20 辆车到站，20 min 内累计有 60 辆车到站，求至第 15 min 时累计到站的公交车数 $X$ 的分布。
此即，已知 $[0, 10]$ 时间内有 20 辆车到站（记为 **$[0, 10] = 20$**）、$[10, 20]$ 时间内有 40 辆车到站（记为 **$[10, 20] = 40$**），求 $[10, 15] = X - 20$ 的概率分布。由**增量独立性**，有
$$
\begin{align}
P \left\{ X = k \right\} &= P \left\{ [10, 15] = k - 20 \mid [0, 10] = 20, [10, 20] = 40 \right\} \\
&= \dfrac{P \left\{ [10, 15] = k - 20, [0, 10] = 20, [10, 20] = 40 \right\}}{P \left\{ [0, 10] = 20, [10, 20] = 40 \right\}} \\
&= \dfrac{\cancel{P \left\{ [0, 10] = 20 \right\}} \cdot P \left\{ [10, 15] = k - 20 \right\} \cdot P \left\{ [15, 20] = 60 - k \right\}}{\cancel{ P \left\{ [0, 10] = 20 \right\} } \cdot P \left\{ [10, 20] = 40 \right\}} \\
&= \cfrac{\dfrac{(5\lambda)^{k-20}}{(k-20)!} \e^{-5\lambda} \cdot \dfrac{(5\lambda)^{60-k}}{(60-k)!} \e^{-5\lambda}}{\dfrac{(10\lambda)^{40}}{40!} \e^{-10\lambda}} = \dfrac{40!}{(k-20)!(60-k)!} \left(\dfrac{1}{2}\right)^{40}
\end{align}
$$

4. 该站点有 3 路公交停靠，概率分别为 $\cfrac{1}{2}$、$\dfrac{1}{3}$ 和 $\dfrac{1}{6}$。已知 10 min 内有 30 辆车到站，求 3 路公交车各有 10 辆到站的概率。
3 路公交车到站的事件**各自服从参数为 $\cfrac{\lambda}{2}$、$\dfrac{\lambda}{3}$ 和 $\dfrac{\lambda}{6}$ 的 Poisson 过程**，记 $N_{1}(t)$、$N_{2}(t)$ 和 $N_{3}(t)$ 分别为 3 路公交车在时间 $t$ 内到站的次数。它们相互独立，因此所求为
$$
\begin{align}
&P \left\{ N_{1}(10) = 10, N_{2}(10) = 10, N_{3}(10) = 10 \mid N(10) = 30 \right\} \\
&= \dfrac{P \left\{ N_{1}(10) = 10 \right\} \cdot P \left\{ N_{2}(10) = 10 \right\} \cdot P \left\{ N_{3}(10) = 10 \right\}}{P \left\{ N(10) = 30 \right\}} \\
&= \cfrac{\dfrac{(10 \cdot \lambda/2)^{10}}{10!} \e^{-10 \cdot \lambda/2} \cdot \dfrac{(10\cdot\lambda/3)^{10}}{10!} \e^{-10\cdot \lambda/3} \cdot \dfrac{(10 \cdot \lambda/6)^{10}}{10!} \e^{-10\cdot\lambda/6}}{\dfrac{(10\lambda)^{30}}{30!} \e^{-10\lambda}}  \\
&= \dfrac{30!}{(10!)^{3}} \left(\dfrac{1}{6}\right)^{10} \left(\dfrac{1}{3}\right)^{10} \left(\dfrac{1}{2}\right)^{10}
\end{align}
$$

5. 已知 1 min 内有 2 辆车到站，则第 4 辆车到站的时间 $S_{4}$ 的分布为
$$
\begin{align}
F_{S_{4} \mid N(1) = 2}(t) &= P \left\{ S_{4} \le t \mid N(1) = 2 \right\} = \dfrac{P \left\{ S_{4} \le t, N(1) = 2 \right\}}{P \left\{ N(1) = 2 \right\}} \\
&= \dfrac{P \left\{ N(t) - N(1) \ge 2 \} \cdot P \{ N(1) = 2 \right\}}{P \left\{ N(1) = 2 \right\}} = P \left\{ N(t) - N(1) \ge 2 \right\} \\
&= 1 - P \left\{ N(t) - N(1) = 0 \right\} - P \left\{ N(t) - N(1) = 1 \right\} \\
&= \begin{cases}
0, & t \le 1, \\
1 - \e^{-\lambda (t-1)} - \lambda (t-1) \e^{-\lambda (t-1)}, & t > 1
\end{cases}
\end{align}
$$
因此其期望为
$$
\begin{align}
\mathbb{E} \left[ S_{4} \mid N(1) = 2 \right] &= \dint_{0}^{\infty} (1 - F_{S_{4} \mid N(1) = 2}(t)) \dif t \\
&= \dint_{1}^{\infty} \left( \e^{-\lambda (t-1)} + \lambda (t-1) \e^{-\lambda (t-1)} \right) \dif t = \dfrac{2}{\lambda} + 1
\end{align}
$$

## L15 (11/25)

### L15-1

**一般时间条件下 Poisson 过程的分布。**

我们已知 Poisson 过程两次事件之间的[[Poisson 过程#事件间隔分布|事件间隔分布]]为指数分布，即设 $N(t)$ 是参数为 $\lambda$ 的 Poisson 过程，**已知 $S_{n}$** 时，$(S_{n+1} - S_{n}) \mid S_{n} \stackrel{\text{d}}{=} S_{n+1} - S_{n} \sim \mathrm{Exp}(\lambda)$。

考虑**已知 $N(t_{0}) = n$**，尝试求出此时下一个事件发生时间的分布。一个直观的想法是
$$
P \left\{ S_{N(t_{0})+1} - S_{N(t_{0})} \le x \mid N(t_{0}) = n \right\} \stackrel{\text{?}}{=} P \left\{ S_{n+1} - S_{n} \le x \right\} = 1 - \e^{-\lambda x}
$$
但实际上并不成立。因为**已知 $N(t_{0}) = n$** 相当于**已知 $S_{n} \le t_{0} < S_{n+1}$**，即已知了**从 $S_{n}$ 到 $t_{0}$ 之间没有事件发生**，这会影响下一个事件发生时间的分布。

记 $\begin{cases}A(t_{0}) = S_{N(t_{0})+1} - t_{0}, \\ B(t_{0}) = t_{0} - S_{N(t_{0})}\end{cases}$，则有
$$
P\left\{ A(t_{0}) > x, B(t_{0}) > y \right\} = P \left\{ N(x + y) = 0 \right\} = \e^{-\lambda (x+y)}
$$
因此，对任意的 $t_{0}$，有
$$
\begin{align} 
&P \left\{ A(t_{0}) \le x \right\} = 1 - P \left\{ A(t_{0}) > x \right\} = 1 - P \left\{ A(t_{0}) > x, B(t_{0}) > 0 \right\} = 1 - \e^{-\lambda x} \\
&P \left\{ B(t_{0}) \le y \right\} = 1 - P \left\{ B(t_{0}) > y \right\} = 1 - P \left\{ A(t_{0}) > 0, B(t_{0}) > y \right\} = 1 - \e^{-\lambda y} 
\end{align}
$$
二者独立，且均服从参数为 $\lambda$ 的指数分布。

### L15-2

**固定时间内 Poisson 过程的事件数。**

设 $N(t)$ 是参数为 $\lambda$ 的 Poisson 过程，**已知 $N(t_{0}) = n$**，求在时间区间 $(0, t_{0}]$ 内事件发生的时间点的分布。



## L17 (12/02)

### L17-1

某公交站 $[0,T]$ 内共来 $n$ 辆公交车，乘客以参数 $\lambda$ 的 **Poisson 分布** $N(t)$ 到来，每次车到站时将站台所有乘客接走，求使得**平均总等待时间最小**的发车安排。

不妨考虑第一次来车前的情况。设在 $[0,t]$ 内未来车，则乘客的总等待时间为
$$
Y(t) = \sum\limits_{i=1}^{N(t)} (t - \tau_{i})
$$
平均总等待时间即 $Y(t)$ 的期望为
$$
\begin{align} 
\mathbb{E} \left[ Y(t) \right] &= \mathbb{E} \left[ tN(t) - \sum\limits_{i=1}^{N(t)} \tau_{k} \right] = t \mathbb{E} \left[ N(t) \right] - \mathbb{E} \left[ \sum\limits_{i=1}^{N(t)} \tau_{k} \right] \\
&= t \cdot \lambda t - \mathbb{E}_{N(t)} \left[ \mathbb{E}_{\tau \mid N(t)} \left[ \sum\limits_{k=1}^{n} \tau_{k} \mathop{\Bigg|} N(t) = n \right]  \right] = \lambda t^{2} - \dfrac{\lambda}{2}t^{2} = \dfrac{\lambda}{2} t^{2}
\end{align}
$$

这样，设每个发车间隔为 $t_{i}$，则最小化总平均等待时间即在**约束条件 $\sum\limits_{i=1}^{n} t_{i} = T$** 下最小化**凸的**目标函数 $\sum\limits_{i=1}^{n} \cfrac{\lambda}{2} t_{i}^{2}$。由凸优化的**均值不等式**可知，当 $t_{1} = t_{2} = \cdots = t_{n} = \cfrac{T}{n}$ 时取得最小值。

### L17-2

某公园游客的**进入**服从参数 $\lambda$ 的 Poisson 分布 $N(t)$，每个游客的停留时间独立同分布地服从 $f(t)$。设 $Y(t)$ 表示 $t$ 时刻园内游客人数，求 $\mathbb{E} \left[ Y(t) \right]$。

此问题重在**表示出 $Y(t)$**，即需要给出游客的**离开**的分布。不妨先写出
$$
Y(t) =\sum\limits_{k=1}^{N(t)} Y_{k}(t, \tau_{k}), \qquad Y_{k}(t, \tau_{k}) = \begin{cases}
1, & 0 \le t-\tau_{k} \le T_{k}, \\
0, & \text{otherwise}
\end{cases}
$$
其中 $T_{k}$ 就是游客的停留时间，即 $T_{k} \stackrel{\text{i.i.d}}{\sim} f(t)$。

引入特征函数，有
$$
\phi_{Y(t)} (\omega) = \exp\left( \lambda \dint_{0}^{t} (\mathbb{E} \left[ \exp(\J \omega Y_{1}(t,\tau)) \right] - 1 ) \dif \tau \right)
$$
进而
$$
\mathbb{E} \left[ Y(t) \right] = \dfrac{1}{\J} \dfrac{ \partial }{ \partial \omega } \phi_{Y(t)}(\omega) \Big|_{\omega=0} = \lambda \dint_{0}^{t} \mathbb{E} \left[ Y_{1}(t, \tau_{1}) \right] \dif \tau_{1}
$$
当 $t > \tau_{1}$ 时 $Y_{1}(t, \tau_{1})$ 才计入 $Y(t)$ 求和式，此时有
$$
\mathbb{E} \left[ Y_{1}(t, \tau_{1}) \right] = P \left\{ Y_{1}(t, \tau_{1}) = 1 \right\} = P \left\{ T_{1} > t - \tau_{1} \right\} = \dint_{t-\tau_{1}}^{\infty} f(s) \dif s
$$
代入即可。

### L17-3

对参数为 $\lambda$ 的 Poisson 分布 $N(t)$，前两个事件时刻为 $S_{1}$、$S_{2}$。

求 $\mathbb{E} \left[ S_{1} + S_{2} \right]$：直接由期望的线性性质得到 $\mathbb{E} \left[ S_{1} + S_{2} \right] = \cfrac{3}{\lambda}$。

求 $\mathbb{E} \left[ S_{1}S_{2} \right]$：由**增量独立性**，
$$
\mathbb{E} \left[ S_{1}S_{2} \right] = \mathbb{E} \left[ S_{1}(S_{2}-S_{1}+S_{1}) \right] = \mathbb{E} \left[ S_{1} \right] \mathbb{E} \left[ S_{2} - S_{1} \right] + \underbrace{ \mathrm{Var}(S_{1}) + (\mathbb{E} \left[ S_{1} \right] )^{2} }_{ \mathbb{E} \left[ S_{1}^{2} \right]  } = \dfrac{3}{\lambda^{2}}
$$

求 $\mathbb{E} \left[ S_{1} \mid N(t) \ge 1 \right]$：考虑 $S_{1} \mid N(t) \ge 1$ 的条件分布函数 $F_{S_{1} \mid N(t) \ge 1}(x)$，注意到必然有 $t \ge S_{1}$，则限定 $x \le t$，有
$$
\begin{align} 
F_{S_{1} \mid N(t) \ge 1}(x) &= P \left\{ S_{1} \le x \mid N(t) \ge 1 \right\} = \dfrac{P \left\{ S_{1} \le x, N(t) \ge 1 \right\}}{P \left\{ N(t) \ge 1 \right\}} \\
&= \dfrac{P \left\{ N(x) \ge 1, N(t) \ge 1 \right\}}{P \left\{ N(t) \ge 1 \right\}} = \dfrac{P \left\{ N(x) \ge 1 \right\}}{P \left\{ N(t) \ge 1 \right\}} = \dfrac{1 - \e^{-\lambda x}}{1 - \e^{-\lambda t}} 
\end{align}
$$
进而
$$
f_{S_{1} \mid N(t) \ge 1}(x) = \dfrac{\dif}{\dif x} F_{S_{1} \mid N(t) \ge 1}(x) = \dfrac{\lambda \e^{-\lambda x}}{1 - \e^{-\lambda t}}, \qquad 0 \le x \le t
$$
因此
$$
\mathbb{E} \left[ S_{1} \mid N(t) \ge 1 \right] = \dint_{0}^{t} x f_{S_{1} \mid N(t) \ge 1}(x) \dif x = \dfrac{1}{\lambda} - \dfrac{t \e^{-\lambda t}}{1 - \e^{-\lambda t}}
$$

## L19 (12/11)

### L19-1

**一维无限制随机游走 (random walk) 中各状态的性质。**

设随机游走 $S_{n} = \sum\limits_{i=1}^{n} X_{i}$，其中 $X_{i} \stackrel{\text{i.i.d}}{\sim} \begin{pmatrix}1 & -1 \\ p & 1-p \end{pmatrix}$。显然，$S_{n}$ 是一个 $\mathbb{Z}$ 上的 **Markov 链**，所有整数点具有相同的性质，因此我们只需考察**状态 0 的常返性**。

经 $n$ 步从 0 回到 0 的概率为
$$
P_{0,0}(n) = \begin{cases}
\binom{2k}{k} p^{k} (1-p)^{k}, & n = 2k,  \\
0, & n = 2k+1, 
\end{cases} \quad k = 0,1,2,\cdots
$$
故其常返性取决于级数
$$
\sum\limits_{k=1}^{\infty} P_{0,0}(2k) = \sum\limits_{k=1}^{\infty} \binom{2k}{k} (p(1-p))^{k} = \sum\limits_{k=1}^{\infty} \dfrac{(2k)!}{(k!)^{2}} (p(1-p))^{k}
$$

利用 **Stirling 公式** $n! \sim \sqrt{2 \pi n} \left( \cfrac{n}{\e} \right)^{n}$，有
$$
\dfrac{(2k)!}{(k!)^{2}} (p(1-p))^{k} \sim \dfrac{\sqrt{ 4\pi k } \left( \cfrac{2k}{\e} \right)^{2k}}{2 \pi k \left( \cfrac{k}{\e} \right)^{2k}} (p(1-p))^{k} = \dfrac{(4p(1-p))^{k}}{\sqrt{\pi k}} 
$$
+ 若 $p = \cfrac{1}{2}$，则 $4p(1-p) = 1$，级数发散，**状态 0 为常返态**，此时随机游走是**平衡**的；
+ 若 $p \ne \cfrac{1}{2}$，则 $4p(1-p) < 1$，级数收敛，**状态 0 为非常返态**。

### L19-2

**二维无限制平衡随机游走中各状态的性质。**

设二维随机游走 $\v{S}_{n} = \sum\limits_{i=1}^{n} \v{X}_{i}$，其中概率分布取平衡的 $\v{X}_{i} \stackrel{\text{i.i.d}}{\sim} \begin{pmatrix} (1,0) & (-1,0) & (0,1) & (0,-1) \\ \cfrac{1}{4} & \cfrac{1}{4} & \cfrac{1}{4} & \cfrac{1}{4} \end{pmatrix}$。同样地，我们只需考察**状态 $\v{0}$ 的常返性**。

显然奇数步不可返回，经 $2n$ 步从 $\v{0}$ 回到 $\v{0}$ 的概率为
$$
\begin{align} 
P_{\v{0},\v{0}}(2n) &= \sum\limits_{k=0}^{n} \dfrac{(2n)!}{(k!)^{2} ((n-k)!)^{2}} \left( \dfrac{1}{4} \right)^{2n}  \\
&= \left( \dfrac{1}{4} \right)^{2n} \binom{2n}{n} \sum\limits_{k=0}^{n} \binom{n}{k} \binom{n}{n-k} = \left( \dfrac{1}{4} \right)^{2n} \binom{2n}{n}^{2} 
\end{align}
$$
利用 Stirling 公式，有
$$
\left( \dfrac{1}{4} \right)^{2n} \binom{2n}{n}^{2} \sim \left( \dfrac{1}{4} \right)^{2n} \dfrac{4^{2n}}{\pi n} = \dfrac{1}{\pi n}
$$
因此级数 $\sum\limits_{n=1}^{\infty} P_{\v{0},\v{0}}(2n) \sim \sum\limits_{n=1}^{\infty} \cfrac{1}{n}$ 发散，**状态 $\v{0}$ 为常返态**。

## L21 (12/23)

### L21-1

**气体分子的 Ehrenfest 模型。**

考虑有 $N$ 个气体分子的容器分成左右两部分，记左侧部分的分子数为 $X_{n}$。设气体分子的扩散行为为：每个时间单位内有且仅有一个分子移到另一侧。则 $\{X_{n}\}$ 是一个**状态空间为 $S = \{0,1,2,\cdots,N\}$ 的 Markov 链**，其转移概率为
$$
\boldsymbol{P} = \begin{pmatrix}
0 & 1 & 0 & 0 & \cdots & 0 & 0 \\
\cfrac{1}{N} & 0 & \cfrac{N-1}{N} & 0 & \cdots & 0 & 0 \\
0 & \cfrac{2}{N} & 0 & \cfrac{N-2}{N} & \cdots & 0 & 0 \\
0 & 0 & \cfrac{3}{N} & 0 & \cdots & 0 & 0 \\
\vdots & \vdots & \ddots & \ddots & \ddots & \ddots & \vdots \\
\vdots & \vdots & \vdots & \ddots & \ddots & \ddots & \vdots \\
0 & 0 & 0 & 0 & \cdots & 1 & 0 \\
\end{pmatrix}
$$
易见该 Markov 链**不可约且有限**，因此**所有状态均为常返态**，且周期为 2。将方程 $\v{\pi} = \v{\pi} \boldsymbol{P}$ 展开，有
$$
\begin{cases}
\pi_{0} = \cfrac{1}{N} \pi_{1}, \\
\pi_{1} = \pi_{0} + \cfrac{2}{N} \pi_{2}, \\
\pi_{2} = \cfrac{N-1}{N} \pi_{1} + \cfrac{3}{N} \pi_{3}, \\
\cdots \\
\pi_{k} = \cfrac{N-(k-1)}{N} \pi_{k-1} + \cfrac{k+1}{N} \pi_{k+1}, \\
\cdots \\
\pi_{N} = \cfrac{1}{N} \pi_{N-1}
\end{cases}
$$
注意到此递推关系形如
$$
\binom{N}{k} = \dfrac{N-(k-1)}{N} \binom{N}{k-1} + \dfrac{k+1}{N} \binom{N}{k+1}
$$
因此可猜测平稳分布为二项分布形式 $\pi_{k} = \pi_{0} \binom{N}{k}$，代入归一化条件 $\sum\limits_{k=0}^{N} \pi_{k} = 1$ 可得 $\pi_{0} = \dfrac{1}{2^{N}}$，即
$$
\pi_{k} = \dfrac{1}{2^{N}} \binom{N}{k}, \qquad k = 0,1,2,\cdots,N
$$