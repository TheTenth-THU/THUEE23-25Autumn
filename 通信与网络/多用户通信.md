## 多用户通信的资源切分

多用户通信专注于讨论简单拓扑结构下**多个信息流（收发对）共享通信资源（时，频等）的方法**，包括多址（局域网）和复接（广域网）。

**多址 (multi access) 通信**是局域网的核心知识，典型的局域网拓扑包括：

![[局域网拓扑.png]]

广域网的长距离传输，为提效、降成本，常把多个用户的信息流通过共同的光纤、铜缆、卫星、微波中继传输，称为**复接 (multiplexing)**。

![[广域网拓扑.png]]

无论是多址，还是复接，本质上都依赖于对通信资源的划分，又称**信道化 (channelization)**。

### 时分与频分多址

**时分多址 (time division multiple access, TDMA)** 是将时间划分为多个时隙，不同用户在不同的时隙内发送数据，从而实现多个用户共享同一频带；**频分多址 (frequency division multiple access, FDMA)** 是将频带划分为多个子信道，不同用户在不同的子信道内发送数据，从而实现多个用户同时传输数据。

TD 与 FD 实现简洁，且可以混用，如第 2 代移动通信中的 D-AMPS 系统。

> [!example] 

## 访问控制

### Aloha

Aloha 是夏威夷大学开发的无线多址协议，基本思想是**随机接入 (random access)**，即用户在有数据发送时**随机选择时间**发送数据。发送后，
+ 若无冲突，接收方发送确认 (ACK)，发送方收到 ACK 后结束传输；
+ 若有冲突，发送方在**随机等待一段时间**后重新发送数据。

由于 Aloha 中采用**定长分组**，记帧长为 $b$ 个 bit，传输速率为 $R_{\mathrm{b}}$ (bit/s)，则每帧传输时间为
$$
T_{\mathrm{fr}} = \dfrac{b}{R_{\mathrm{b}}}
$$
定义 Aloha 系统的**供给业务量**为 1 帧时间内「尝试传输」的平均次数，记为 $G$，则单位时间内「尝试传输」的平均次数为 $\lambda_{\mathrm{t}} = \cfrac{G}{T_{\mathrm{fr}}}$；再记**成功传输概率**（无任何碰撞的概率）为 $p_{\mathrm{suc}}$，则单位时间内成功传输的平均次数为 $\lambda_{\mathrm{t}} p_{\mathrm{suc}}$。

给出一个引理：大量独立同分布更新过程的叠加为一个 Poisson 过程。因此，对于海量用户，记每个用户的**帧生成率**（用户单位时间内尝试接入的次数）为 $\lambda_{\mathrm{u}}$，则所有用户的**总帧生成率**为 $\lambda_{\mathrm{t}} = N \lambda_{\mathrm{u}}$。换言之，
+ 单个用户的尝试（帧）到达率 $\lambda_{\mathrm{u}} = \cfrac{\lambda _\mathrm{t}}{N} \xrightarrow{N \to +\infty} 0$；
+ 对任意一个给定的用户来说，其看到的「背景业务」（其他用户的尝试）到达率为 $(N - 1) \lambda_{\mathrm{u}} \approx \cfrac{N-1}{N} \lambda_{\mathrm{t}} \xrightarrow{N \to +\infty} \lambda_{\mathrm{t}}$。

这样，对于任意一个给定的用户来说，其看到的**背景业务到达过程**为**参数为 $\lambda_{\mathrm{t}}$ 的 Poisson 过程**。本用户在时间 $t$ 发送一帧数据，若在**脆弱时间 (vulnerable time) $[t - T_{\mathrm{fr}}, t + T_{\mathrm{fr}}]$** 内有其他用户发送数据，则会发生碰撞，导致发送失败。由于背景业务到达过程为参数为 $\lambda_{\mathrm{t}}$ 的 Poisson 过程，因此在该时间段内没有其他用户发送数据的概率为
$$
p_{\mathrm{suc}} = \Pr \left\{ N(2T_{\mathrm{fr}}) = 0 \right\} = \e^{-2 \lambda_{\mathrm{t}} T_{\mathrm{fr}}} = \e^{-2G}
$$

> [!theorem] Aloha 系统的吞吐量
> 海量用户 Aloha 系统的**帧吞吐量**（单位时间内成功传输的帧数）为
> $$
> \lambda = \lambda_{\mathrm{t}} \e^{-2\lambda_{\mathrm{t}} T_{\mathrm{fr}}} = \dfrac{G}{T_{\mathrm{fr}}} \cdot \e^{-2G}
> $$
> **比特吞吐量**为
> $$
> \lambda_{\mathrm{b}} = \lambda b = R_{\mathrm{b}} G \e^{-2G}
> $$
> 其**归一化吞吐量**（$R_{\mathrm{b}}$ 中被有效利用的比例）即为
> $$
> \rho = \dfrac{\lambda_{\mathrm{b}}}{R_{\mathrm{b}}} = G \e^{-2G}
> $$

### 时隙 Aloha

**时隙 Aloha (slotted Aloha)** 是对 Aloha 的改进，假设所有用户**时间同步**，将时间划分为多个时隙，用户只能在**时隙开始**时发送数据。这样，脆弱时间缩短为 $T_{\mathrm{fr}}$，成功传输概率变为
$$
p_{\mathrm{suc}} = \Pr \left\{ N(T_{\mathrm{fr}}) = 0 \right\} = \e^{-\lambda_{\mathrm{t}} T_{\mathrm{fr}}} = \e^{-G}
$$
或者，每个用户在一个时隙内的发送概率为 $p = \lambda_{\mathrm{u}} T_{\mathrm{fr}} = \cfrac{\lambda_{\mathrm{t}}T_{\mathrm{fr}}}{N} = \cfrac{G}{N}$，则在该时隙内有且仅有一个用户发送数据的概率为
$$
N p_{\mathrm{u},\mathrm{suc}} = N \cdot p (1 - p)^{N - 1} = G \left( 1 - \dfrac{G}{N} \right)^{N-1} \xrightarrow{N \to +\infty} G \e^{-G}
$$

> [!theorem] 时隙 Aloha 系统的吞吐量
> 海量用户时隙 Aloha 系统的**帧吞吐量**为
> $$
> \lambda = \lambda_{\mathrm{t}} \e^{-\lambda_{\mathrm{t}} T_{\mathrm{fr}}} = \dfrac{G}{T_{\mathrm{fr}}} \cdot \e^{-G}
> $$
> **比特吞吐量**为
> $$
> \lambda_{\mathrm{b}} = \lambda b = R_{\mathrm{b}} G \e^{-G}
> $$
> 其**归一化吞吐量**为
> $$
> \rho = \dfrac{\lambda_{\mathrm{b}}}{R_{\mathrm{b}}} = G \e^{-G}
> $$

> [!note] 题型：Aloha 与时隙 Aloha
> **典型题型 1**　对于海量用户 Aloha 与时隙 Aloha 系统，求最能有效利用信息速率 $R_{\mathrm{b}}$ 的供给业务量 $G$、帧生成率 $\lambda_{\mathrm{t}}$、帧长 $b$ 或帧传输时间 $T_{\mathrm{fr}}$。
> 
> + 纯 Aloha 对 $\rho = G\e^{-2G}$ 求导得到 $G^{*} = \cfrac{1}{2}$，此时 $\rho_{\mathrm{max}} = \cfrac{1}{2\e} \approx 0.184$。
> + 时隙 Aloha 对 $\rho = G\e^{-G}$ 求导得到 $G^{*} = 1$，此时 $\rho_{\mathrm{max}} = \cfrac{1}{\e} \approx 0.368$。
> 
> **典型题型 2**　给定 Aloha 或时隙 Aloha 系统的部分参数（如单用户帧生成率 $\lambda_{\mathrm{u}}$、帧长 $b$ 等）与部分物理层参数（如工作频率），求对通信链路速率 $R_{\mathrm{b}}$ 利用率最高的物理层参数（如滚降系数 $\alpha$、调制阶数 $M$）。
> 
> 由 $G^{*} = 0.5$ 或 $1$，结合 $\lambda_{\mathrm{t}} = N \lambda_{\mathrm{u}}$ 和 $T_{\mathrm{fr}} = \cfrac{b}{R_{\mathrm{b}}}$ 可得
> $$
> R_{\mathrm{b}}^{*} = \dfrac{N \lambda_{\mathrm{u}} b}{G^{*}}
> $$
> 结合物理层速率表达式（如带宽 $B$、调制阶数 $M$、滚降系数 $\alpha$ 等），即可求解出最优物理层参数。

### 载波侦听 (CSMA)

**载波侦听多址 (carrier sense multiple access, CSMA)** 是对 Aloha 的进一步改进，用户在发送数据前**先监听信道**，若信道空闲则发送数据，若信道忙碌则等待一段随机时间后重新监听。CSMA 可分为三种类型：
+ **非坚持 CSMA (non-persistent CSMA)**：信道忙碌时，用户等待一段随机时间后重新监听信道；
+ **1-坚持 CSMA (1-persistent CSMA)**：信道忙碌时，用户持续监听信道，直至信道空闲后立即发送数据；
+ **$p$-坚持 CSMA ($p$-persistent CSMA)**：适用于时隙化信道，信道空闲时，用户以概率 $p$ 发送数据，以概率 $1-p$ 等待下一个时隙。

以太网的核心协议**带冲突检测的载波侦听 (CSMA with collision detection, CSMA/CD)** 就是基于 CSMA 的改进。其基本思想是，用户在发送数据时**持续监听信道**，若检测到冲突，则**立即停止发送**。

#### CSMA/CD 与以太网

为了更好地「通知」全网发生了冲突，在检测到冲突时发送一个**冲突信号 (jamming signal)**。以太网**有线媒介的封闭特性**决定了对于网中任意节点发送的信号在其它各节点处侦听的功率近似相同，这使得可以很容易地区分**信道空闲**、**信道忙碌**和**信道冲突** 3 种状态，从而实现载波侦听。

设网络中最大传播时间为 $\tau$，则
+ 为了确保发送节点能够检测到冲突，需有**帧长 $T_{\mathrm{fr}} > 2\tau$**；
+ 自上一帧传完起，**经过 $\tau$ 时间**后最远的节点也**确认信道空闲**，此时才开始竞争；
+ 每次竞争耗时 $2\tau$ （从发送节点发送信号到最远节点，再从最远节点返回发送节点），可设**经过 $k$ 次竞争**后成功。

这样，传输 1 帧的平均耗时为
$$
\mathbb{E} \left[ T \right] = \mathbb{E} \left[ T_{\mathrm{fr}} + \tau + 2\tau k \right] = T_{\mathrm{fr}} + \tau + 2\tau \mathbb{E} \left[ k \right]
$$
可记 $a = \cfrac{\tau}{T_{\mathrm{fr}}}$，则（总有用户试图尝试接入时）CSMA/CD 的效率为
$$
\eta = \dfrac{T_{\mathrm{fr}}}{\mathbb{E} \left[ T \right]} = \dfrac{1}{1 + a (1 + 2 \mathbb{E} \left[ k \right])}
$$

设用户尝试接入的概率为 $q$，则一个竞争时隙内有且仅有一个用户发送数据的概率为
$$
\gamma = N q (1 - q)^{N - 1}
$$
知 $q = \cfrac{1}{N}$ 时，$\gamma$ 取最大值 $\gamma_{\mathrm{max}} = \left( 1 - \cfrac{1}{N} \right)^{N - 1} \xrightarrow{N \to +\infty} \cfrac{1}{\e}$。因此，**平均竞争次数**为
$$
\mathbb{E} \left[ k \right] = \sum_{k=1}^{+\infty} k \cdot (1 - \gamma)^{k-1} \gamma = \dfrac{1}{\gamma} \xrightarrow{N \to +\infty} \e
$$
代入效率表达式，得到 CSMA/CD 的效率极限为
$$
\eta_{\mathrm{max}} = \dfrac{1}{1 + a (1 + 2\e)} \approx \dfrac{1}{1 + 6.44a}
$$